# Cloud Pub/Sub まとめ

## 概要
- 対象: グローバルに拡張可能なメッセージング（トピック/サブスクリプション）
- 主用途: 非同期疎結合、イベント駆動、ストリーミング、ファンアウト、バックプレッシャー緩衝

## 利点
- 耐久/スケール: 高可用・耐久ストレージと自動スケール、リージョン冗長トピック
- 柔軟な配信: Pull/Push 配信、デッドレター、メッセージ順序（ordering key）
- 運用容易: スキーマ検証、フィルタリング、IAM制御、Cloud Functions/Run/Workflows連携

## 欠点
- 配信セマンティクス: 基本は少なくとも1回配信（重複受信の考慮が必要）
- 順序制約: ordering key 単位での順序保証、グローバルな全順序ではない
- 可視性/デバッグ: 大規模分散でのトラブルシュートに慣れが必要

## 価格の利点
- 従量課金: メッセージあたり/転送量/保管で課金、Pub/Sub Lite で低コスト選択肢
- スケールメリット: 高スループット時でも管理費用がほぼ不要

## 価格の欠点
- エグレス/保持: 長期保持やリージョン間転送で費用増
- 重複処理: 少なくとも1回配信による下流の冪等処理が追加工数/コスト

## 選定の目安
- 向く: 疎結合なイベント駆動、マイクロサービス連携、ストリーミング取込
- 代替: 厳密な処理順序や exactly-once 要件→ Dataflow/トランザクションストア側で補完

## コスト最適化 Tips
- Pub/Sub Lite の検討（スループットが予測可能な場合）
- メッセージ設計（小さいペイロード、圧縮、バッチパブリッシュ）
- サブスク側の並列/バッチ pull、適切な保持期間設定
