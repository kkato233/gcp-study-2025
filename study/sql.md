# Google Cloud データベース選定まとめ

本ファイルは、主要な GCP データベース/ストアの用途、利点・欠点、価格面のメリット/デメリットを簡潔に整理したものです。

## Cloud Spanner（分散RDB）
- 利点
  - グローバル/マルチリージョンで強整合、同期レプリケーション
  - 水平スケール、自動フェイルオーバー、RPO=0に近い設計
  - 高可用・高スループットを一元的に満たせる
- 欠点
  - MySQL/PostgreSQL 互換ではない（SQL/スキーマ移行が必要）
  - 学習コスト、運用ベストプラクティスの習得が必要
- 価格メリット
  - 高可用・スケール要件をまとめて満たす場合の単価効率が高い
- 価格デメリット
  - プロビジョニング前提でミニマム費用が高め（小規模は割高）

## AlloyDB for PostgreSQL（高性能RDB）
- 利点
  - PostgreSQL互換、高性能（列キャッシュ/ローカルSSD等）、リージョン内HA
  - 読み取りプールでスケール、既存PG資産を活かしやすい
- 欠点
  - グローバル強整合の書き込みは不可（基本リージョン内）
  - インスタンス運用（サイズ/レプリカ）設計が必要
- 価格メリット
  - vCPUあたり性能が高く、再開発コストが抑えられる
- 価格デメリット
  - 24/7リソース課金でアイドル時も費用、レプリカ増で積み上がる

## Cloud SQL（MySQL/PostgreSQL/SQL Server）
- 利点
  - 高い互換性、マネージド運用（バックアップ/パッチ/HA）
  - 小〜中規模のRDB用途に開始しやすい
- 欠点
  - 書き込みスケールは縦方向が中心、単一プライマリに依存
  - クロスリージョン強整合なし（非同期系が中心）
- 価格メリット
  - シンプル構成で導入容易、必要十分な運用機能
- 価格デメリット
  - スケールに伴い急速に高額化、IOやストレージ/レプリカで加算

## Firestore（ドキュメント型NoSQL）
- 利点
  - サーバレス自動スケール、リアルタイム更新、マルチリージョンオプション
  - 運用ほぼ不要、従量課金で小規模に強い
- 欠点
  - JOIN不可/クエリ制約、トランザクション範囲に制限
  - ホットスポット回避などキー/コレクション設計が必要
- 価格メリット
  - 待機時ほぼゼロコスト、ユース量に比例
- 価格デメリット
  - 高頻度R/Wや読み取り拡散でオペレーション課金が跳ねやすい

## Cloud Bigtable（ワイドカラムNoSQL）
- 利点
  - 超大規模・低レイテンシ、時系列/キー指向に最適
  - スループットの線形スケール、ストレージと計算の独立性
- 欠点
  - マルチ行/テーブルACIDなし、参照整合性が必要なRDB用途に不向き
  - スキーマ/行キー設計の難易度が高い
- 価格メリット
  - ノード単位の処理性能が高く、大規模でコスパ良好
- 価格デメリット
  - 最小ノード数要件で小規模は割高、複製で費用増

## BigQuery（サーバレスDWH：分析向け）
- 利点
  - 超並列クエリ、ストレージとコンピュート分離、ほぼ運用不要
  - データレイク/ウェアハウス統合に適する
- 欠点
  - OLTPに不向き（行更新/トランザクション機能が限定的）
  - 低レイテンシ書き込みや頻繁アップサート用途には適さない
- 価格メリット
  - ストレージ単価が安価、クエリ従量 or スロット定額の柔軟性
- 価格デメリット
  - フルスキャンや設計不備でクエリ費用が急増、最適化必須

## Memorystore（Redis/Memcached：インメモリ）
- 利点
  - 非常に低レイテンシ、キャッシュ/セッション/レート制御に最適
  - マネージドで可用性オプションあり
- 欠点
  - 永続性/ACIDなし（データ消失前提の設計）
  - データセットがRAMサイズに依存
- 価格メリット
  - バックエンド負荷削減でトータルコスト削減効果
- 価格デメリット
  - RAMは高価、スケールアウトで比例して費用増

## Cloud Storage（オブジェクト：補足比較）
- 利点
  - 安価・高耐久・強整合・大容量。アーカイブ/配信に最適
- 欠点
  - データベースではない（低レイテンシR/Wやクエリ不可）
- 価格観点
  - ストレージ単価は安いが、小オブジェクト頻繁R/Wは費用/レイテンシが不利

---

## 価格モデルの要点
- プロビジョニング型（Spanner/Bigtable/AlloyDB/Cloud SQL/Memorystore）
  - 利用率が高いほど単価効率が良い。アイドル時も費用発生。
- サーバレス従量型（Firestore/BigQuery）
  - 小規模や突発負荷に強い。高頻度R/Wやフルスキャンでコスト急増に注意。

## ざっくり選定目安
- グローバル強整合OLTP/高可用/水平スケール → Cloud Spanner
- 高性能RDBでPG互換/リージョン内HA → AlloyDB
- 一般的RDB/高互換性/中規模 → Cloud SQL
- サーバレス/柔軟スキーマ/リアルタイム → Firestore
- 時系列/巨大KV/低レイテンシ大規模 → Bigtable
- DWH/BI/大規模集計 → BigQuery
- キャッシュ/セッション → Memorystore

## マルチリージョン強整合（MySQLからの移行観点）
- 最適解: Cloud Spanner（マルチリージョン構成）
  - 強整合な分散トランザクション、同期レプリケーション、自動フェイルオーバー
  - 注意: MySQL互換ではない（AUTO_INCREMENT代替、主キー設計などの調整が必要）
- 不適な候補（この要件に対して）
  - BigQuery: DWH/OLAP向けでOLTPに不向き
  - Cloud SQL: クロスリージョン強整合なし、単一プライマリに依存
  - Cloud Bigtable: マルチ行ACIDなし、最終的整合シナリオあり
