# Cloud Spanner まとめ

## 概要
- 対象: 強整合・水平スケール・高可用を備えた分散RDBMS
- 主用途: グローバル/マルチリージョンのOLTP、ミッションクリティカルなトランザクション

## 利点
- 強整合と可用性: 同期レプリケーション、RPO=0/RTO分オーダーの自動フェイルオーバー
- スケーラビリティ: ノード追加で水平スケール、スループット/容量を独立に調整可能
- 運用容易: バックアップ/自動メンテナンス/オンラインスキーマ変更

## 欠点
- 互換性: MySQL/PostgreSQL互換ではない（SQL/スキーマの適応が必要）
- 設計要件: 主キー設計、セカンダリインデックス、ID生成戦略（AUTO_INCREMENTの代替）
- 学習コスト: 最適なデータモデリング/パーティショニングの理解が必要

## 価格の利点
- 一元化: HA/DR/スケール要件を単一プロダクトで満たしトータルコスト最適化
- 予測可能性: 容量/ノード単位で見積り容易、運用の人件費圧縮

## 価格の欠点
- 最低コスト: 小規模ワークロードでは割高になりやすい
- リージョン冗長: マルチリージョンは冗長費用が乗る

## 選定の目安
- 向く: 複数リージョンで強整合・高可用が必須、将来の大規模スケールを見据えるケース
- 代替: 既存PG互換/高性能→ AlloyDB、最小変更移行→ Cloud SQL、スキーマ柔軟→ Firestore

## 移行のポイント（MySQL 例）
- スキーマ/初期移行: HarbourBridge（spanner-migration-tool）で変換
- 増分同期: Datastream + Dataflow テンプレートでCDC取り込み
- カットオーバー: 二重書き→読取切替→書込切替でダウンタイム最小化

## コスト最適化 Tips
- リージョン/インスタンス構成を要件から最小限に設計
- ホットスポット回避のキー設計と適切なインデックス設計
- 需要に応じたノード/ストレージ調整と監視アラート
