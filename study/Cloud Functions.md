# Cloud Functions まとめ

## 概要
- 対象: イベント駆動のサーバレス関数（2nd gen は Cloud Run / Eventarc 基盤）
- 主用途: Webhook/HTTPエンドポイント、Pub/Sub・GCS・Firestore 等のイベント処理、軽量ETL/Glue、バックエンドの小粒度ロジック

## 利点
- 開発速度: 関数単位でデプロイ可能、トリガ設定で即イベント連携
- スケール: ゼロからの自動スケール、2nd gen は同時実行/最小インスタンスの調整が可能
- 連携性: Eventarc 経由で多数のGCPサービスからトリガ、Secret Manager・IAM・VPCコネクタ対応
- 運用簡素: OS/ランタイムの管理不要、リビジョン・ロールバック・観測性（ログ/メトリクス/トレース）

## 欠点
- 実行制約: タイムアウト上限やメモリ上限があり、長時間常駐処理に不向き
- コールドスタート: アイドルからの初回呼び出し遅延（最小インスタンス/軽量化で緩和）
- 設計分散: 小関数が増えると依存関係やコストの可視化が難しくなる

## 価格の利点
- 従量課金: 実行時間（vCPU・メモリ）と呼び出し回数に応じ課金、フリー枠あり
- ゼロアイドル: 使わない時のコストを最小化しやすい（最小インスタンス0時）

## 価格の欠点
- 高頻度イベント: 呼び出し課金とログ/ネットワークが積み上がる
- 常時高負荷: 常時稼働や重い処理は GKE/GCE/Cloud Run の方がコスパ有利な場合

## 選定の目安
- 向く: イベント駆動、疎結合な小粒度のバックエンド、Webhook、軽量変換
- 代替: バッチ・並列制御→ Cloud Run Jobs、複雑なパイプライン→ Dataflow、オーケストレーション→ Workflows、長時間/特殊ドライバ→ GCE/GKE

## コスト最適化 Tips
- 2nd gen の同時実行・最小インスタンスを調整してコールドスタートと費用のバランス
- 入出力の同リージョン配置、VPC コネクタの帯域/課金考慮
- 冪等/バッチ化で呼び出し回数を抑制、ログの保持期間・出力量を最適化
